metadata:
        format: Lava-Test Test Definition 1.0
        name: modules-tools
        description: "Test kernel tracing on various kernel"

params:
        URCU_GIT: master
        MODULES_GIT: master
        UST_GIT: master
        TOOLS_GIT: master
        BABELTRACE_GIT: master

devices:
        - kvm
install:
        git-repos:
                - url: https://github.com/urcu/userspace-rcu
                  branch: URCU_GIT
                  destination: userspace-rcu_src
                - url: https://github.com/lttng/lttng-ust
                  branch: UST_GIT
                  destination: lttng-ust_src
                - url: https://github.com/lttng/lttng-tools
                  branch: TOOLS_GIT
                  destination: lttng-tools_src
                - url: https://github.com/efficios/babeltrace
                  branch: BABELTRACE_GIT
                  destination: babeltrace_src
run:
        steps:
                - "lava-test-case install_00 --shell cd userspace-rcu_src"
                - "lava-test-case install_01 --shell ./bootstrap"
                - "lava-test-case install_02 --shell ./configure"
                - "lava-test-case install_03 --shell make"
                - "lava-test-case install_04 --shell make install"
                - "lava-test-case install_05 --shell ldconfig -v"
                - "lava-test-case install_06 --shell cd .."
                - "lava-test-case install_07 --shell cd babeltrace_src"
                - "lava-test-case install_08 --shell ./bootstrap"
                - "lava-test-case install_09 --shell ./configure"
                - "lava-test-case install_10 --shell make"
                - "lava-test-case install_11 --shell make install"
                - "lava-test-case install_12 --shell ldconfig -v"
                - "lava-test-case install_13 --shell cd .."
                - "lava-test-case install_14 --shell cd lttng-ust_src"
                - "lava-test-case install_15 --shell ./bootstrap"
                - "lava-test-case install_16 --shell ./configure"
                - "lava-test-case install_17 --shell make"
                - "lava-test-case install_18 --shell make install"
                - "lava-test-case install_19 --shell ldconfig -v"
                - "lava-test-case install_20 --shell cd .."
                - "lava-test-case install_21 --shell cd lttng-tools_src"
                - "lava-test-case install_22 --shell ./bootstrap"
                - "lava-test-case install_23 --shell ./configure"
                - "lava-test-case install_24 --shell make"
                - "lava-test-case install_25 --shell make install"
                - "lava-test-case install_26 --shell ldconfig -v"
                - "lava-test-case install_27 --shell cd .."
                - "lava-test-case ls --shell ls /root"
                - "lava-test-case tar --shell tar -xvf /root/4.4.0-rc4.tar -C /lib/modules/"
                - "lava-test-case depmod --shell depmod -a -v"
                - "lava-test-case linux-version --shell uname -a"
                - "lava-test-case pwd --shell pwd"
                - "lava-test-case list-folder-modules --shell ls /lib/modules"
                - "lava-test-case dry-modprobe --shell modprobe --dry-run lttng-test -v"
                - "lava-test-case real-modprobe --shell modprobe lttng-test -v"
                - "lava-test-case list-mod --shell lsmod"
